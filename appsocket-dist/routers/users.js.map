{"version":3,"sources":["../../appsocket/routers/users.js"],"names":["router","Router","get","req","res","json","post","next","query","pick","body","socket_id","Error","findOne","then","user","error","status","insert","result","catch"],"mappings":";;;;;;AAGA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1BA,QAAIC,IAAJ,CAAS,EAAC,SAAS,GAAV,EAAT;AACH,CAFD;;AAIAL,OAAOM,IAAP,CAAY,GAAZ,EAAiB,UAACH,GAAD,EAAMC,GAAN,EAAWG,IAAX,EAAoB;AACjC,QAAMC,QAAQ,iBAAEC,IAAF,CAAON,IAAIO,IAAX,EAAiB,WAAjB,EAA8B,UAA9B,EAA0C,MAA1C,CAAd;;AAEA,QAAG,CAACF,MAAMG,SAAV,EAAoB;AAChBJ,aAAK,IAAIK,KAAJ,CAAU,gBAAV,CAAL;AACH,KAFD,MAEK;AACD,+BAAeC,OAAf,CAAuB,OAAvB,EAAgC;AAC5BF,uBAAWH,MAAMG;AADW,SAAhC,EAEGG,IAFH,CAEQ,gBAAQ;AACZ,gBAAGC,IAAH,EAAQ;AACJ,oBAAMC,QAAQ,IAAIJ,KAAJ,CAAU,QAAV,CAAd;AACAI,sBAAMC,MAAN,GAAe,GAAf;AACA,sBAAMD,KAAN;AACH,aAJD,MAIK;AACD,uBAAO,uBAAeE,MAAf,CAAsB,OAAtB,EAA+BV,KAA/B,CAAP;AACH;AACJ,SAVD,EAUGM,IAVH,CAUQ,kBAAU;AACdV,gBAAIa,MAAJ,CAAW,GAAX,EAAgBZ,IAAhB,CAAqB;AACjBU,sBAAMI;AADW,aAArB;AAGH,SAdD,EAcGC,KAdH,CAcS,iBAAS;AACdJ,kBAAMC,MAAN,GAAe,GAAf;AACAV,iBAAKS,KAAL;AACH,SAjBD;AAkBH;AACJ,CAzBD;;kBA2BehB,M","file":"users.js","sourcesContent":["/**\n * @flow \n * */\nimport _ from 'lodash';\nimport express from 'express';\nimport MongoDBManager from '../utils/mongoManager';\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => {\n    res.json({\"state\": 222});\n});\n\nrouter.post('/', (req, res, next) => {\n    const query = _.pick(req.body, 'socket_id', 'nickname', 'logo');\n\n    if(!query.socket_id){\n        next(new Error('Socket ID 不可為空'));\n    }else{\n        MongoDBManager.findOne('users', {\n            socket_id: query.socket_id\n        }).then(user => {\n            if(user){\n                const error = new Error('使用者已存在');\n                error.status = 404;\n                throw(error);\n            }else{\n                return MongoDBManager.insert('users', query);\n            }\n        }).then(result => {\n            res.status(200).json({\n                user: result\n            });\n        }).catch(error => {\n            error.status = 500;\n            next(error);\n        });\n    }\n});\n\nexport default router"]}